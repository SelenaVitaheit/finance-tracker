<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="display-6">üéØ <%= @goal.title %></h1>
          <div class="text-muted">
            <small>
              –°–æ–∑–¥–∞–Ω–∞: <%= time_ago_in_words(@goal.created_at) %> –Ω–∞–∑–∞–¥ ‚Ä¢ 
              –û–±–Ω–æ–≤–ª–µ–Ω–∞: <%= time_ago_in_words(@goal.updated_at) %> –Ω–∞–∑–∞–¥
            </small>
          </div>
        </div>
        <div>
          <span class="badge bg-<%= @goal.completed? ? 'success' : @goal.deadline < Date.today ? 'danger' : 'primary' %> fs-6">
            <% if @goal.completed? %>
              ‚úÖ –¶–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
            <% elsif @goal.deadline < Date.today %>
              ‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–∞
            <% else %>
              üéØ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
            <% end %>
          </span>
        </div>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center border-primary">
            <div class="card-body">
              <h6 class="card-title text-muted">–ü—Ä–æ–≥—Ä–µ—Å—Å</h6>
              <div class="display-4 fw-bold text-primary">
                <%= @goal.progress_percentage %>%
              </div>
              <div class="mt-3">
                <%= progress_bar(@goal.progress_percentage, height: '10px') %>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card text-center border-success">
            <div class="card-body">
              <h6 class="card-title text-muted">–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞</h6>
              <div class="display-4 fw-bold text-success">
                <%= number_to_currency(@goal.current_amount, unit: '‚ÇΩ', format: '%n') %>
              </div>
              <small class="text-muted">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</small>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card text-center border-info">
            <div class="card-body">
              <h6 class="card-title text-muted">–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞</h6>
              <div class="display-4 fw-bold text-info">
                <%= number_to_currency(@goal.target_amount, unit: '‚ÇΩ', format: '%n') %>
              </div>
              <small class="text-muted">–ù—É–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å</small>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card text-center border-<%= @goal.amount_remaining > 0 ? 'danger' : 'success' %>">
            <div class="card-body">
              <h6 class="card-title text-muted">–û—Å—Ç–∞–ª–æ—Å—å</h6>
              <div class="display-4 fw-bold text-<%= @goal.amount_remaining > 0 ? 'danger' : 'success' %>">
                <%= number_to_currency(@goal.amount_remaining, unit: '‚ÇΩ', format: '%n') %>
              </div>
              <small class="text-muted">–ï—â–µ –Ω—É–∂–Ω–æ</small>
            </div>
          </div>
        </div>
      </div>

      <!-- –î–µ–¥–ª–∞–π–Ω –∏ –≤—Ä–µ–º—è -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">üìÖ –°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <small class="text-muted">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</small>
                  <div class="fw-bold"><%= format_date(@goal.created_at.to_date) %></div>
                </div>
                <div class="col">
                  <small class="text-muted">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</small>
                  <div class="fw-bold <%= @goal.deadline < Date.today ? 'text-danger' : '' %>">
                    <%= format_date(@goal.deadline) %>
                  </div>
                </div>
                <div class="col">
                  <small class="text-muted">–î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å</small>
                  <div class="fw-bold <%= @goal.days_remaining > 30 ? 'text-success' : @goal.days_remaining > 7 ? 'text-warning' : 'text-danger' %>">
                    <%= @goal.days_remaining %>
                  </div>
                </div>
              </div>
              
              <% if @goal.days_remaining > 0 && !@goal.completed? %>
                <div class="mt-3">
                  <small class="text-muted">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</small>
                  <div class="h4 text-primary">
                    <%= number_to_currency(@goal.amount_remaining / (@goal.days_remaining / 30.0), unit: '‚ÇΩ') %>
                    <small class="text-muted">/–º–µ—Å—è—Ü</small>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0">üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h5>
            </div>
            <div class="card-body">
              <div style="position: relative; height: 200px;">
                <canvas id="goalProgressChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
      <% if @goal.description.present? %>
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏</h5>
          </div>
          <div class="card-body">
            <p class="card-text"><%= simple_format(@goal.description) %></p>
          </div>
        </div>
      <% end %>

      <!-- –î–µ–π—Å—Ç–≤–∏—è -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">‚ö° –î–µ–π—Å—Ç–≤–∏—è —Å —Ü–µ–ª—å—é</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <% unless @goal.completed? %>
              <%= link_to '‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—É–º–º—É', "#", 
                  class: 'btn btn-success me-2 disabled',
                  title: '–ë—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–∑–∂–µ' %>
            <% end %>
            
            <%= link_to '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', edit_goal_path(@goal), 
                class: 'btn btn-primary me-2' %>
            
            <%= link_to 'üìä –í—Å–µ —Ü–µ–ª–∏', goals_path, 
                class: 'btn btn-outline-secondary me-2' %>         
             </div>
          
          <% unless @goal.completed? %>
            <div class="text-center mt-3">
              <small class="text-muted">
                <i class="bi bi-lightbulb me-1"></i>
                –°–æ–≤–µ—Ç: –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Ç–µ–∫—É—â—É—é —Å—É–º–º—É –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
              </small>
            </div>
          <% end %>
        </div>
      </div>

      <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π -->
      <div class="text-center mt-4">
        <small class="text-muted">
          ID —Ü–µ–ª–∏: <%= @goal.id %> ‚Ä¢ 
          –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <%= @goal.updated_at.strftime('%d.%m.%Y %H:%M') %>
        </small>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('goalProgressChart').getContext('2d');
  
  const progress = <%= @goal.progress_percentage %>;
  const remaining = 100 - progress;
  
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–û—Å—Ç–∞–ª–æ—Å—å'],
      datasets: [{
        data: [progress, remaining],
        backgroundColor: [
          progress >= 100 ? '#198754' : '#0dcaf0',
          '#e9ecef'
        ],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.label}: ${context.raw.toFixed(1)}%`;
            }
          }
        }
      }
    }
  });
});
</script>