<%= form_with(model: goal, local: true) do |form| %>
  <% if goal.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(goal.errors.count, "error") %> prohibited this goal from being saved:</h4>
      <ul>
        <% goal.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= form.label :title, 'Название цели', class: 'form-label' %>
    <%= form.text_field :title, 
        class: 'form-control', 
        placeholder: 'Например: Накопить на отпуск, Купить ноутбук',
        required: true %>
    <div class="form-text">Краткое и понятное название</div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="mb-3">
        <%= form.label :target_amount, 'Целевая сумма', class: 'form-label' %>
        <div class="input-group">
          <%= form.number_field :target_amount, 
              class: 'form-control', 
              step: '0.01',
              min: '0.01',
              required: true %>
          <span class="input-group-text">₽</span>
        </div>
        <div class="form-text">Сколько нужно накопить</div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="mb-3">
        <%= form.label :current_amount, 'Текущая сумма', class: 'form-label' %>
        <div class="input-group">
          <%= form.number_field :current_amount, 
              class: 'form-control', 
              step: '0.01',
              min: '0' %>
          <span class="input-group-text">₽</span>
        </div>
        <div class="form-text">Сколько уже накоплено</div>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :deadline, 'Срок выполнения', class: 'form-label' %>
    <%= form.date_field :deadline, 
        class: 'form-control', 
        min: Date.today,
        required: true %>
    <div class="form-text">Дата, к которой нужно достичь цели</div>
  </div>

  <div class="mb-3">
    <%= form.label :description, 'Описание', class: 'form-label' %>
    <%= form.text_area :description, 
        class: 'form-control', 
        rows: 3,
        placeholder: 'Опишите цель подробнее...' %>
    <div class="form-text">Необязательно, но полезно для мотивации</div>
  </div>

  <div class="d-flex justify-content-between align-items-center">
    <div>
      <% if goal.persisted? %>
        <div class="text-muted">
          <small>
            Прогресс: <strong><%= goal.progress_percentage %>%</strong> • 
            Осталось: <strong><%= number_to_currency(goal.amount_remaining, unit: '₽') %></strong> • 
            Дней до срока: <strong><%= goal.days_remaining %></strong>
          </small>
        </div>
      <% end %>
    </div>
    
    <div class="btn-group">
      <%= form.submit goal.persisted? ? 'Обновить цель' : 'Создать цель', 
          class: 'btn btn-primary' %>
      <%= link_to 'Отмена', goals_path, class: 'btn btn-outline-secondary' %>
    </div>
  </div>
<% end %>