<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1>üéØ –ú–æ–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏</h1>
      <p class="text-muted mb-0">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≤–∞—à–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</p>
    </div>
    <%= link_to '‚ûï –ù–æ–≤–∞—è —Ü–µ–ª—å', new_goal_path, class: 'btn btn-primary' %>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-3">
          <h6 class="mb-0">–§–∏–ª—å—Ç—Ä—ã:</h6>
        </div>
        <div class="col-md-9">
          <div class="btn-group" role="group">
            <%= link_to '–í—Å–µ', goals_path, 
                class: "btn btn-outline-secondary #{params[:status].blank? ? 'active' : ''}" %>
            <%= link_to '–ê–∫—Ç–∏–≤–Ω—ã–µ', goals_path(status: 'active'), 
                class: "btn btn-outline-success #{params[:status] == 'active' ? 'active' : ''}" %>
            <%= link_to '–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ', goals_path(status: 'completed'), 
                class: "btn btn-outline-info #{params[:status] == 'completed' ? 'active' : ''}" %>
            <%= link_to '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ', goals_path(status: 'expired'), 
                class: "btn btn-outline-danger #{params[:status] == 'expired' ? 'active' : ''}" %>
          </div>
          
          <div class="btn-group ms-3" role="group">
            <%= link_to '–ü–æ —Å—Ä–æ–∫—É', goals_path(sort: 'deadline'), 
                class: "btn btn-outline-secondary #{params[:sort] == 'deadline' ? 'active' : ''}" %>
            <%= link_to '–ü–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É', goals_path(sort: 'progress'), 
                class: "btn btn-outline-secondary #{params[:sort] == 'progress' ? 'active' : ''}" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–ª–µ–π -->
  <% if @goals.any? %>
    <% total_goals = @goals.count %>
    <% completed_goals = @goals.select(&:completed?).count %>
    <% active_goals = @goals.reject(&:completed?).count %>
    <% expired_goals = @goals.select { |g| g.deadline < Date.today }.count %>
    
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card bg-light">
          <div class="card-body text-center">
            <h5 class="card-title text-muted">–í—Å–µ–≥–æ —Ü–µ–ª–µ–π</h5>
            <p class="display-6"><%= total_goals %></p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-success text-white">
          <div class="card-body text-center">
            <h5 class="card-title">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</h5>
            <p class="display-6"><%= completed_goals %></p>
            <small><%= total_goals > 0 ? (completed_goals * 100 / total_goals) : 0 %>%</small>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-warning">
          <div class="card-body text-center">
            <h5 class="card-title">–ê–∫—Ç–∏–≤–Ω—ã–µ</h5>
            <p class="display-6"><%= active_goals %></p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-danger text-white">
          <div class="card-body text-center">
            <h5 class="card-title">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</h5>
            <p class="display-6"><%= expired_goals %></p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- –°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π -->
  <% if @goals.any? %>
    <div class="row">
      <% @goals.each do |goal| %>
        <div class="col-md-6 mb-4">
          <div class="card h-100 <%= goal.completed? ? 'border-success' : goal.deadline < Date.today ? 'border-danger' : 'border-primary' %>">
            <div class="card-header d-flex justify-content-between align-items-center <%= goal.completed? ? 'bg-success text-white' : goal.deadline < Date.today ? 'bg-danger text-white' : 'bg-primary text-white' %>">
              <h5 class="mb-0">
                <%= goal.title.truncate(30) %>
                <% if goal.completed? %>
                  <span class="badge bg-light text-dark">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞</span>
                <% elsif goal.deadline < Date.today %>
                  <span class="badge bg-light text-dark">‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–∞</span>
                <% end %>
              </h5>
              <div class="dropdown">
                <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                  –î–µ–π—Å—Ç–≤–∏—è
                </button>
                <ul class="dropdown-menu">
                  <li><%= link_to '–ü—Ä–æ—Å–º–æ—Ç—Ä', goal, class: 'dropdown-item' %></li>
                  <li><%= link_to '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', edit_goal_path(goal), class: 'dropdown-item' %></li>
                 <li class="dropdown-item p-0">
  <%= button_to '–£–¥–∞–ª–∏—Ç—å', goal, 
      method: :delete,
      form: { 
        data: { confirm: '–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ü–µ–ª—å?' },
        class: 'w-100'
      },
      class: 'btn btn-link text-danger text-decoration-none w-100 text-start px-3 py-2 border-0 bg-transparent' %>
</li>
                  <% unless goal.completed? %>
                    <li><hr class="dropdown-divider"></li>
                    <li><%= link_to '–î–æ–±–∞–≤–∏—Ç—å —Å—É–º–º—É', "#", class: 'dropdown-item disabled' %></li>
                  <% end %>
                </ul>
              </div>
            </div>
            
            <div class="card-body">
              <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
              <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-muted">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                  <span class="fw-bold"><%= goal.progress_percentage %>%</span>
                </div>
                <%= progress_bar(goal.progress_percentage) %>
              </div>
              
              <!-- –°—É–º–º—ã -->
              <div class="row mb-3">
                <div class="col">
                  <small class="text-muted">–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞</small>
                  <div class="h5 <%= goal.completed? ? 'text-success' : 'text-primary' %>">
                    <%= number_to_currency(goal.current_amount, unit: '‚ÇΩ') %>
                  </div>
                </div>
                <div class="col">
                  <small class="text-muted">–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞</small>
                  <div class="h5">
                    <%= number_to_currency(goal.target_amount, unit: '‚ÇΩ') %>
                  </div>
                </div>
                <div class="col">
                  <small class="text-muted">–û—Å—Ç–∞–ª–æ—Å—å</small>
                  <div class="h5 <%= goal.amount_remaining > 0 ? 'text-danger' : 'text-success' %>">
                    <%= number_to_currency(goal.amount_remaining, unit: '‚ÇΩ') %>
                  </div>
                </div>
              </div>
              
              <!-- –î–µ–¥–ª–∞–π–Ω -->
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-muted">
                    <i class="bi bi-calendar me-1"></i>
                    –°—Ä–æ–∫: <%= format_date(goal.deadline) %>
                  </small>
                </div>
                <div>
                  <span class="badge bg-<%= goal.days_remaining > 30 ? 'success' : goal.days_remaining > 7 ? 'warning' : 'danger' %>">
                    <% if goal.days_remaining > 0 %>
                      –û—Å—Ç–∞–ª–æ—Å—å <%= goal.days_remaining %> –¥–Ω–µ–π
                    <% elsif goal.days_remaining == 0 %>
                      –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å!
                    <% else %>
                      –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ <%= -goal.days_remaining %> –¥–Ω–µ–π
                    <% end %>
                  </span>
                </div>
              </div>
              
              <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
              <% if goal.description.present? %>
                <hr>
                <p class="card-text"><small><%= goal.description.truncate(100) %></small></p>
              <% end %>
            </div>
            
            <div class="card-footer bg-transparent">
              <small class="text-muted">
                –°–æ–∑–¥–∞–Ω–∞: <%= time_ago_in_words(goal.created_at) %> –Ω–∞–∑–∞–¥ ‚Ä¢
                –û–±–Ω–æ–≤–ª–µ–Ω–∞: <%= time_ago_in_words(goal.updated_at) %> –Ω–∞–∑–∞–¥
              </small>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="bi bi-flag display-1 text-muted"></i>
      </div>
      <h3>–¶–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
      <p class="text-muted mb-4">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
      <%= link_to '–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Ü–µ–ª—å', new_goal_path, class: 'btn btn-primary btn-lg' %>
    </div>
  <% end %>
</div>