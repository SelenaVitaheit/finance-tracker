<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Мои транзакции</h1>
    <%= link_to 'Новая транзакция', new_transaction_path, class: 'btn btn-primary' %>
  </div>

  <!-- Фильтры -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Фильтры</h5>
      <%= form_with url: transactions_path, method: :get, local: true, class: 'row g-3' do |form| %>
        <div class="col-md-3">
          <%= form.label :type, 'Тип', class: 'form-label' %>
          <%= form.select :type, 
              [['Все', ''], ['Доходы', 'income'], ['Расходы', 'expense']], 
              { selected: params[:type] }, 
              class: 'form-select' %>
        </div>
        
        <div class="col-md-3">
          <%= form.label :category_id, 'Категория', class: 'form-label' %>
          <%= form.select :category_id, 
              options_from_collection_for_select(@categories, :id, :display_name, params[:category_id]),
              { include_blank: 'Все категории' },
              class: 'form-select' %>
        </div>
        
        <div class="col-md-3">
          <%= form.label :month, 'Месяц', class: 'form-label' %>
          <%= form.month_field :month, value: params[:month], class: 'form-control' %>
        </div>
        
        <div class="col-md-3 d-flex align-items-end">
          <div class="btn-group w-100">
            <%= form.submit 'Применить', class: 'btn btn-outline-primary' %>
            <%= link_to 'Сбросить', transactions_path, class: 'btn btn-outline-secondary' %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Статистика -->
  <% if @transactions.any? %>
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-white bg-success">
          <div class="card-body">
            <h5 class="card-title">Доходы</h5>
            <p class="card-text h4">
              <%= number_to_currency(@transactions.incomes.sum(:amount), unit: '₽', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-danger">
          <div class="card-body">
            <h5 class="card-title">Расходы</h5>
            <p class="card-text h4">
              <%= number_to_currency(@transactions.expenses.sum(:amount), unit: '₽', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-info">
          <div class="card-body">
            <h5 class="card-title">Баланс</h5>
            <p class="card-text h4">
              <% balance = @transactions.incomes.sum(:amount) - @transactions.expenses.sum(:amount) %>
              <%= number_to_currency(balance, unit: '₽', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Всего</h5>
            <p class="card-text h4">
		<%= @transactions.count %> транзакций
            </p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Таблица транзакций -->
  <% if @transactions.any? %>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th>Дата</th>
            <th>Категория</th>
            <th>Описание</th>
            <th class="text-end">Сумма</th>
            <th>Тип</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          <% @transactions.each do |transaction| %>
            <tr class="<%= transaction.transaction_type == 'income' ? 'table-success' : 'table-danger' %>">
              <td><%= transaction.date.strftime('%d.%m.%Y') %></td>
              <td><%= transaction.category&.name || 'Без категории' %></td>
              <td><%= truncate(transaction.description, length: 50) %></td>
              <td class="text-end fw-bold">
                <%= transaction.display_amount %>
              </td>
              <td>
                <span class="badge bg-<%= transaction.transaction_type == 'income' ? 'success' : 'danger' %>">
                  <%= transaction.transaction_type == 'income' ? 'Доход' : 'Расход' %>
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <%= link_to 'Просмотр', transaction, class: 'btn btn-outline-primary' %>
                  <%= link_to 'Редактировать', edit_transaction_path(transaction), class: 'btn btn-outline-secondary' %>
                  <%= link_to 'Удалить', transaction, 
    data: { 
      turbo_method: :delete,
      turbo_confirm: 'Вы уверены?'
    },
    class: 'btn btn-outline-danger' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
        </div>

    <!-- Пагинация -->
    <div class="d-flex justify-content-center mt-4">
      <nav>
        <ul class="pagination">
          <li class="page-item disabled">
            <span class="page-link">Пагинация будет добавлена позже</span>
          </li>
        </ul>
      </nav>
    </div>
  <% end %>
</div>

<!-- Стили для таблицы -->
<style>
  .table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.075);
  }
</style>
