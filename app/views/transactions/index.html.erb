<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>–ú–æ–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h1>
    <%= link_to '–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è', new_transaction_path, class: 'btn btn-primary' %>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">–§–∏–ª—å—Ç—Ä—ã</h5>
      <%= form_with url: transactions_path, method: :get, local: true, class: 'row g-3' do |form| %>
        <div class="col-md-3">
          <%= form.label :type, '–¢–∏–ø', class: 'form-label' %>
          <%= form.select :type, 
              [['–í—Å–µ', ''], ['–î–æ—Ö–æ–¥—ã', 'income'], ['–†–∞—Å—Ö–æ–¥—ã', 'expense']], 
              { selected: params[:type] }, 
              class: 'form-select' %>
        </div>
        
        <div class="col-md-3">
          <%= form.label :category_id, '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', class: 'form-label' %>
          <%= form.select :category_id, 
              options_from_collection_for_select(@categories, :id, :display_name, params[:category_id]),
              { include_blank: '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' },
              class: 'form-select' %>
        </div>
                
        <div class="col-md-3 d-flex align-items-end">
          <div class="btn-group w-100">
            <%= form.submit '–ü—Ä–∏–º–µ–Ω–∏—Ç—å', class: 'btn btn-outline-primary' %>
            <%= link_to '–°–±—Ä–æ—Å–∏—Ç—å', transactions_path, class: 'btn btn-outline-secondary' %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <% if @transactions.any? %>
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-white bg-success">
          <div class="card-body">
            <h5 class="card-title">–î–æ—Ö–æ–¥—ã</h5>
            <p class="card-text h4">
              <%= number_to_currency(@transactions.incomes.sum(:amount), unit: '‚ÇΩ', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-danger">
          <div class="card-body">
            <h5 class="card-title">–†–∞—Å—Ö–æ–¥—ã</h5>
            <p class="card-text h4">
              <%= number_to_currency(@transactions.expenses.sum(:amount), unit: '‚ÇΩ', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-info">
          <div class="card-body">
            <h5 class="card-title">–ë–∞–ª–∞–Ω—Å</h5>
            <p class="card-text h4">
              <% balance = @transactions.incomes.sum(:amount) - @transactions.expenses.sum(:amount) %>
              <%= number_to_currency(balance, unit: '‚ÇΩ', format: '%n %u') %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">–í—Å–µ–≥–æ</h5>
            <p class="card-text h4">
		<%= @transactions.count %> —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            </p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π -->
  <% if @transactions.any? %>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th class="text-end">–°—É–º–º–∞</th>
            <th>–¢–∏–ø</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          <% @transactions.each do |transaction| %>
            <tr class="<%= transaction.transaction_type == 'income' ? 'table-success' : 'table-danger' %>">
              <td><%= transaction.date.strftime('%d.%m.%Y') %></td>
              <td><%= transaction.category&.name || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' %></td>
              <td><%= truncate(transaction.description, length: 50) %></td>
              <td class="text-end fw-bold">
                <%= transaction.display_amount %>
              </td>
              <td>
                <span class="badge bg-<%= transaction.transaction_type == 'income' ? 'success' : 'danger' %>">
                  <%= transaction.transaction_type == 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥' %>
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <%= link_to '–ü—Ä–æ—Å–º–æ—Ç—Ä', transaction, class: 'btn btn-outline-primary' %>
                  <%= link_to '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', edit_transaction_path(transaction), class: 'btn btn-outline-secondary' %>
                  <%= button_to 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å', transaction, 
    method: :delete,
    form: { 
      data: { confirm: '–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?' },
      class: 'd-inline'
    },
    class: 'btn btn-outline-danger btn-sm' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
        </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="d-flex justify-content-center mt-4">
      <nav>
        <ul class="pagination">
          <li class="page-item disabled">
            <span class="page-link">–ü–∞–≥–∏–Ω–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ</span>
          </li>
        </ul>
      </nav>
    </div>
  <% end %>
</div>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã -->
<style>
  .table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.075);
  }
</style>
